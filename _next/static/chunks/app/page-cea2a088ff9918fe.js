(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2254:function(t,e,i){Promise.resolve().then(i.bind(i,7693)),Promise.resolve().then(i.bind(i,82)),Promise.resolve().then(i.bind(i,1795))},1795:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return _}});var o=i(9131),n=i(3905),l=i(453),s=i(7782),r=i(3619),a=i(3794),d=i.n(a),u=i(904),c=i(8856),f=i(4869);function h(t){return null!=t&&/^\s*[-+]?(\d+(\.\d*)?|\.\d+)(e[-+]?\d+)?\s*$/i.test(t)?parseFloat(t):void 0}function x(t){let e=h(t);return null!=e?u.Unitize.feet(e):void 0}function v(t){let e=h(t);return null!=e?u.Unitize.degrees(e):void 0}function g(){let[t,e]=n.useState(""),i=n.useMemo(()=>d()(t=>{let{values:i}=t;setTimeout(()=>{e(function(t){let{shots:e}=t;if(!e)return"";let i={name:"Trip",distanceUnit:u.Length.feet,azimuthUnit:u.Angle.degrees,inclinationUnit:u.Angle.degrees},o=[];for(let t=0;t<e.length-1;t++){var n,l,s,r,a,d,h,g,p,m,b,w,j,y,Z,I,P,k,S,D,A,z,C,L,F,E,M,U,O,R,B,G,N,V,$,T,_,H;let i=null===(l=e[t])||void 0===l?void 0:null===(n=l.from)||void 0===n?void 0:n.station;if(!i)continue;let u=!1,f=null===(s=e[t])||void 0===s?void 0:s.distance;null!=f&&/\*\s*$/.test(f)&&(u=!0,f=f.replace(/\*\s*$/,""));let J=x(f);J&&o.push({from:i,to:(null===(r=e[t+1])||void 0===r?void 0:r.isSplit)?null===(d=e[t+1])||void 0===d?void 0:null===(a=d.to)||void 0===a?void 0:a.station:null===(g=e[t+1])||void 0===g?void 0:null===(h=g.from)||void 0===h?void 0:h.station,kind:c.FrcsShotKind.Normal,distance:J,excludeDistance:u,frontsightAzimuth:v(null===(p=e[t])||void 0===p?void 0:p.frontsightAzimuth),backsightAzimuth:v(null===(m=e[t])||void 0===m?void 0:m.backsightAzimuth),frontsightInclination:v(null===(b=e[t])||void 0===b?void 0:b.frontsightInclination),backsightInclination:v(null===(w=e[t])||void 0===w?void 0:w.backsightInclination),fromLruds:{left:x(null===(y=e[t])||void 0===y?void 0:null===(j=y.from)||void 0===j?void 0:j.left),right:x(null===(I=e[t])||void 0===I?void 0:null===(Z=I.from)||void 0===Z?void 0:Z.right),up:x(null===(k=e[t])||void 0===k?void 0:null===(P=k.from)||void 0===P?void 0:P.up),down:x(null===(D=e[t])||void 0===D?void 0:null===(S=D.from)||void 0===S?void 0:S.down)},toLruds:(null===(A=e[t+1])||void 0===A?void 0:A.isSplit)?{left:x(null===(C=e[t+1])||void 0===C?void 0:null===(z=C.to)||void 0===z?void 0:z.left),right:x(null===(F=e[t+1])||void 0===F?void 0:null===(L=F.to)||void 0===L?void 0:L.right),up:x(null===(M=e[t+1])||void 0===M?void 0:null===(E=M.to)||void 0===E?void 0:E.up),down:x(null===(O=e[t+1])||void 0===O?void 0:null===(U=O.to)||void 0===U?void 0:U.down)}:{left:x(null===(B=e[t+1])||void 0===B?void 0:null===(R=B.from)||void 0===R?void 0:R.left),right:x(null===(N=e[t+1])||void 0===N?void 0:null===(G=N.from)||void 0===G?void 0:G.right),up:x(null===($=e[t+1])||void 0===$?void 0:null===(V=$.from)||void 0===V?void 0:V.up),down:x(null===(_=e[t+1])||void 0===_?void 0:null===(T=_.from)||void 0===T?void 0:T.down)},comment:null===(H=e[t+1])||void 0===H?void 0:H.notes})}return o.map(t=>(0,f.yf)(t,i)).join("\n")}(i))},0)},500),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Z,{multiline:!0,rows:40,sx:{width:600},value:t,InputProps:{readOnly:!0,sx:{fontFamily:"monospace"}}}),(0,o.jsx)(s.lP,{onChange:i,subscription:{values:!0}})]})}var p=i(2795),m=i(5234),b=i(5405);let w=n.memo(function(t){let{startIndex:e=0,useFieldProps:i,layoutVariant:n="IMO"}=t;return(0,o.jsx)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",width:"100%",height:"100%"},children:[...Array(11).keys()].map(t=>(0,o.jsx)(y,{sx:{flexBasis:"".concat(9.090909090909092,"%")},index:t+e,layoutVariant:n,useFieldProps:i,includeShotFields:t<10},t))})}),j=["left","right","up","down"],y=t=>{var e,i,n,s,r,a,d,u;let{sx:c,index:f,useFieldProps:h,includeShotFields:x=!0,layoutVariant:v}=t;null==h||null===(i=h.isSplit)||void 0===i||null===(e=i.call(h,f-1))||void 0===e||e.value;let g=null==h?void 0:null===(n=h.isSplit)||void 0===n?void 0:n.call(h,f),w=(null==g?void 0:g.value)===!0,y=(null==h?void 0:null===(r=h.isSplit)||void 0===r?void 0:null===(s=r.call(h,f+1))||void 0===s?void 0:s.value)===!0,k={position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===v?"19%":"16%","&:not(:hover) > :nth-child(1)":{visibility:"hidden"}};return(0,o.jsxs)(l.Z,{sx:{...c,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[w?(0,o.jsxs)(Z,{sx:k,children:[(0,o.jsx)(p.Z,{title:"Unsplit row",placement:"right",children:(0,o.jsx)(m.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>{var t;return null==g?void 0:null===(t=g.onChange)||void 0===t?void 0:t.call(g,!1)},children:(0,o.jsx)(b.Z,{})})}),(0,o.jsx)(I,{index:f,useFieldProps:null==h?void 0:null===(a=h.to)||void 0===a?void 0:a.station,field:"to.station",above:{field:"from.station",index:f-1},below:{field:"from.station",index:f},right:"distance"}),(0,o.jsx)(I,{index:f,useFieldProps:null==h?void 0:null===(d=h.from)||void 0===d?void 0:d.station,field:"from.station",below:{field:y?"to.station":"from.station",index:f+1},above:{field:"to.station",index:f},right:"distance"})]}):(0,o.jsxs)(l.Z,{sx:{...k,display:"flex"},children:[(0,o.jsx)(p.Z,{title:"Split row",placement:"right",children:(0,o.jsx)(m.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>{var t;return null==g?void 0:null===(t=g.onChange)||void 0===t?void 0:t.call(g,!0)},children:(0,o.jsx)(b.Z,{})})}),(0,o.jsx)(I,{index:f,useFieldProps:null==h?void 0:null===(u=h.from)||void 0===u?void 0:u.station,field:"from.station",above:{field:"from.station",index:f-1},below:{field:y?"to.station":"from.station",index:f+1},right:"distance"})]}),(0,o.jsx)(l.Z,{sx:{position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===v?"37.5%":"40%",pointerEvents:"none"},children:x&&(0,o.jsxs)(l.Z,{sx:{position:"absolute",top:"50%",width:"100%",height:"100%",display:"flex",alignItems:"stretch",pointerEvents:"all"},children:[(0,o.jsx)(I,{index:f,useFieldProps:null==h?void 0:h.distance,field:"distance",left:"from.station",right:"frontsightAzimuth",sx:{flexBasis:0,flexGrow:1,flexShrink:1}}),(0,o.jsxs)(Z,{sx:{flexBasis:0,flexGrow:1,flexShrink:1},children:[(0,o.jsx)(P,{index:f,field:"frontsightAzimuth",useFieldProps:null==h?void 0:h.frontsightAzimuth,above:{field:"backsightAzimuth",index:f-1},below:{field:"backsightAzimuth",index:f},left:"distance",right:"frontsightInclination"}),(0,o.jsx)(P,{index:f,field:"backsightAzimuth",useFieldProps:null==h?void 0:h.backsightAzimuth,above:{field:"frontsightAzimuth",index:f},below:{field:"frontsightAzimuth",index:f+1},left:"distance",right:"backsightInclination"})]}),(0,o.jsxs)(Z,{sx:{flexBasis:0,flexGrow:1,flexShrink:1},children:[(0,o.jsx)(P,{index:f,field:"frontsightInclination",useFieldProps:null==h?void 0:h.frontsightInclination,above:{field:"backsightInclination",index:f-1},below:{field:"backsightInclination",index:f},left:"frontsightAzimuth",right:"from.left"}),(0,o.jsx)(P,{index:f,field:"backsightInclination",useFieldProps:null==h?void 0:h.backsightInclination,above:{field:"frontsightInclination",index:f},below:{field:"frontsightInclination",index:f+1},left:"backsightAzimuth",right:{field:y?"to.left":"from.left",index:f+1}})]})]})}),(0,o.jsxs)(l.Z,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[j.map((t,e)=>{var i,n,l;return w?(0,o.jsxs)(Z,{children:[(0,o.jsx)(I,{index:f,field:"to.".concat(t),useFieldProps:null==h?void 0:null===(i=h.to)||void 0===i?void 0:i[t],above:{field:"from.".concat(t),index:f-1},below:{field:"from.".concat(t),index:f},left:e>0?"to.".concat(j[e-1]):{field:"backsightInclination",index:f-1},right:e<3?"to.".concat(j[e+1]):"notes"}),(0,o.jsx)(I,{index:f,field:"from.".concat(t),useFieldProps:null==h?void 0:null===(n=h.from)||void 0===n?void 0:n[t],above:{field:"to.".concat(t),index:f},below:{field:y?"to.".concat(t):"from.".concat(t),index:f+1},left:e>0?"from.".concat(j[e-1]):"frontsightInclination",right:e<3?"from.".concat(j[e+1]):"notes"})]},t):(0,o.jsx)(I,{index:f,field:"from.".concat(t),useFieldProps:null==h?void 0:null===(l=h.from)||void 0===l?void 0:l[t],above:{field:"from.".concat(t),index:f-1},below:{field:y?"to.".concat(t):"from.".concat(t),index:f+1},left:e>0?"from.".concat(j[e-1]):"frontsightInclination",right:e<3?"from.".concat(j[e+1]):"notes"},t)}),(0,o.jsx)(I,{index:f,field:"notes",useFieldProps:null==h?void 0:h.notes,sx:{flexGrow:0,flexShrink:0,flexBasis:"Lech"===v?"43%":"30%"},left:"from.down"})]})]})};function Z(t){let{sx:e,children:i}=t;return(0,o.jsx)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",...e},children:i})}let I=t=>{let{field:e,index:i,above:l={field:e,index:i-1},below:s={field:e,index:i+1},left:a,right:d,useFieldProps:u,sx:c,inputProps:f,InputProps:h,...x}=t,v=null==u?void 0:u(i),g=n.useCallback(t=>{let e;let o=t.target instanceof HTMLInputElement?t.target:void 0;switch(t.key){case"ArrowUp":t.preventDefault(),e=l;break;case"ArrowDown":t.preventDefault(),e=s;break;case"ArrowLeft":(null==o?void 0:o.selectionStart)===0&&(e=a);break;case"ArrowRight":var n;o&&o.selectionEnd===(null===(n=o.value)||void 0===n?void 0:n.length)&&(e=d)}let r="string"==typeof e?document.querySelector('[data-field="'.concat(e,'"][data-index="').concat(i,'"]')):e?document.querySelector('[data-field="'.concat(e.field,'"][data-index="').concat(e.index,'"]')):void 0;r instanceof HTMLInputElement&&(t.preventDefault(),r.focus(),r.select())},[e,i]);return(0,o.jsx)(r.Z,{...v,...x,onKeyDown:g,sx:{flexGrow:1,flexShrink:1,flexBasis:"10%",backgroundColor:(null==v?void 0:v.value)?"rgba(255, 255, 255, 0.8)":"none","& input":{padding:"2px",textAlign:"center"},...c},inputProps:{"data-field":e,"data-index":i,...f},InputProps:{...h,sx:{borderRadius:0,height:"100%",fontSize:"0.8rem",...null==h?void 0:h.sx}}})},P=t=>{let{sx:e,inputProps:i,InputProps:n,...l}=t;return(0,o.jsx)(I,{...l,sx:{flexGrow:1,flexShrink:1,flexBasis:0,...e},InputProps:{...n,sx:{height:"100%",...null==n?void 0:n.sx}}})};var k=i(8538);let S=k.ZP.object({station:k.ZP.string().optional(),left:k.ZP.string().optional(),right:k.ZP.string().optional(),up:k.ZP.string().optional(),down:k.ZP.string().optional()}),D=k.ZP.object({from:S.optional(),to:S.optional(),isSplit:k.ZP.boolean().optional(),distance:k.ZP.string().optional(),frontsightAzimuth:k.ZP.string().optional(),backsightAzimuth:k.ZP.string().optional(),frontsightInclination:k.ZP.string().optional(),backsightInclination:k.ZP.string().optional(),notes:k.ZP.string().optional()}),A=k.ZP.enum(["IMO","Lech"]),z=k.ZP.object({type:k.ZP.string(),data:k.ZP.string()}),C=k.ZP.object({x:k.ZP.number(),y:k.ZP.number()}),L=k.ZP.object({topLeft:C,topRight:C,bottomLeft:C,bottomRight:C});function F(t){let{top:e,left:i,width:o,height:n}=t;return{topLeft:{x:i,y:e},topRight:{x:i+o,y:e},bottomLeft:{x:i,y:e+n},bottomRight:{x:i+o,y:e+n}}}let E=k.ZP.object({layoutVariant:A.optional(),bounds:L.optional()}),M=k.ZP.object({pageImages:k.ZP.array(z.nullish().transform(t=>null!=t?t:void 0)).optional(),tables:k.ZP.array(E.nullish().transform(t=>null!=t?t:void 0)).optional(),shots:k.ZP.array(D.nullish().transform(t=>null!=t?t:void 0)).optional()});function U(t,e){return(0,n.useCallback)(i=>{let{clientX:o,clientY:n}=i;if("object"!=typeof document)return;let{body:l}=document;function s(i){t(i,{dx:i.clientX-o,dy:i.clientY-n,dragStartProps:e})}l&&(l.addEventListener("mousemove",s,!0),l.addEventListener("mouseup",function i(r){l.removeEventListener("mousemove",s,!0),l.removeEventListener("mouseup",i),t(r,{dx:r.clientX-o,dy:r.clientY-n,dragStartProps:e})}),t(i,{dx:0,dy:0,dragStartProps:e}))},[t])}function O(t){let{handleSize:e=9,bounds:i,sx:n,onResize:s}=t,r=U((t,e)=>{let{dx:i,dy:o,dragStartProps:{bounds:n}}=e;t.preventDefault(),t.stopPropagation(),s({top:n.top+o,left:n.left+i,width:n.width-i,height:n.height-o})},{bounds:i}),a=U((t,e)=>{let{dx:i,dy:o,dragStartProps:{bounds:n}}=e;t.preventDefault(),t.stopPropagation(),s({top:n.top+o,left:n.left,width:n.width+i,height:n.height-o})},{bounds:i}),d=U((t,e)=>{let{dx:i,dy:o,dragStartProps:{bounds:n}}=e;t.preventDefault(),t.stopPropagation(),s({top:n.top,left:n.left+i,width:n.width-i,height:n.height+o})},{bounds:i}),u=U((t,e)=>{let{dx:i,dy:o,dragStartProps:{bounds:n}}=e;t.preventDefault(),t.stopPropagation(),s({top:n.top,left:n.left,width:n.width+i,height:n.height+o})},{bounds:i}),c=(t,i)=>({position:"absolute",top:i-Math.ceil(e/2),left:t-Math.ceil(e/2),width:e,height:e,cursor:"grab",backgroundColor:"currentColor",pointerEvents:"all"});return(0,o.jsxs)(l.Z,{sx:{...i,width:i.width,height:i.height,boxSizing:"border-box",position:"absolute",color:"red",border:"1px solid currentColor",pointerEvents:"none",...n},children:[(0,o.jsx)(l.Z,{sx:c(0,0),onMouseDown:r}),(0,o.jsx)(l.Z,{sx:c(i.width-1,0),onMouseDown:a}),(0,o.jsx)(l.Z,{sx:c(0,i.height-1),onMouseDown:d}),(0,o.jsx)(l.Z,{sx:c(i.width-1,i.height-1),onMouseDown:u})]})}M.omit({pageImages:!0});var R=i(1015);let B=t=>e=>{let{input:i}=(0,s.U$)("shots[".concat(e,"].").concat(t));return i},G={from:{station:B("from.station"),left:B("from.left"),right:B("from.right"),up:B("from.up"),down:B("from.down")},to:{station:B("to.station"),left:B("to.left"),right:B("to.right"),up:B("to.up"),down:B("to.down")},isSplit:B("isSplit"),distance:B("distance"),frontsightAzimuth:B("frontsightAzimuth"),backsightAzimuth:B("backsightAzimuth"),frontsightInclination:B("frontsightInclination"),backsightInclination:B("backsightInclination"),notes:B("notes")},N={layoutVariant:"IMO",bounds:F({top:113,left:15,width:520,height:632})};function V(t){let{pageIndex:e=0}=t,{input:{value:i}}=(0,s.U$)("pageImages[".concat(e,"]")),{input:{value:a=N,onChange:d}}=(0,s.U$)("tables[".concat(e,"]")),{layoutVariant:u=null==N?void 0:N.layoutVariant,bounds:c=null==N?void 0:N.bounds}=a,f=n.useMemo(()=>(function(t){let{topLeft:e,topRight:i,bottomLeft:o,bottomRight:n}=t;if(e.x!==o.x||e.y!==i.y||i.x!==n.x||n.y!==o.y)throw Error("bounds are non-rectilinear, not supported yet");return{top:e.y,left:e.x,width:i.x-e.x,height:o.y-e.y}})(c),[c]);return(0,o.jsxs)(l.Z,{sx:{position:"relative"},children:[(0,o.jsx)(l.Z,{sx:{userSelect:"none"},children:(0,o.jsx)("img",{src:i.data,alt:"survey sheet",height:800})}),(0,o.jsx)(l.Z,{sx:{...f,position:"absolute"},children:(0,o.jsx)(w,{layoutVariant:u,useFieldProps:G,startIndex:11*e})}),(0,o.jsx)(O,{bounds:f,onResize:t=>d({...a,bounds:F(t)})}),(0,o.jsxs)(r.Z,{value:u,variant:"filled",onChange:t=>d({...a,layoutVariant:t.target.value}),select:!0,label:"Layout",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)",position:"absolute",top:f.top-60,left:f.left},children:[(0,o.jsx)(R.Z,{value:"IMO",children:"Inner Mountain Outfitters"}),(0,o.jsx)(R.Z,{value:"Lech",children:"Lechuguilla"})]})]})}function $(t){let{input:{name:e,value:i,onChange:s}}=t,r=n.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},[]),a=n.useCallback(async t=>{t.preventDefault();let{files:e}=t.dataTransfer,o=[...i||[]];for(let t of(await Promise.all([...e].map(async t=>{let e=await new Promise(e=>{let i=new FileReader;i.onload=()=>e(i.result),i.readAsDataURL(t)});if("string"!=typeof e)throw Error("expected readAsDataURL to produce a string");return{type:t.type,data:e}}))))o.push(t);s(o)},[i]);return(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",overflow:"scroll",flexGrow:1,alignSelf:"stretch",maxHeight:1e3},onDragOver:r,onDrop:a,children:[(i||[]).map((t,e)=>(0,o.jsx)(V,{pageIndex:e},e)),(null==i?void 0:i.length)?void 0:(0,o.jsx)(l.Z,{sx:{height:200,textAlign:"center",my:10,alignSelf:"stretch",color:"gray"},children:"Drop images here"})]})}var T=i(7325);function _(){let t=n.useCallback(t=>{console.log(t)},[]),e=n.useMemo(()=>{try{return M.parse({pageImages:JSON.parse(localStorage.getItem("caveSurveyDataPageImages")||""),...JSON.parse(localStorage.getItem("caveSurveyDataValues")||"")})}catch(t){return{pageImages:[],shots:[]}}},[]);return(0,o.jsx)(s.l0,{initialValues:e,onSubmit:t,children:t=>(0,o.jsxs)(l.Z,{sx:{my:4,display:"flex",flexDirection:"row",alignItems:"stretch",position:"relative"},children:[(0,o.jsx)(q,{}),(0,o.jsxs)(l.Z,{sx:{flexBasis:600,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,o.jsx)(H,{}),(0,o.jsx)(J,{})]}),(0,o.jsx)(s.gN,{name:"pageImages",render:t=>(0,o.jsx)($,{...t})})]}),(0,o.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,o.jsx)(r.Z,{label:"Format",select:!0,value:"frcs",children:(0,o.jsx)(R.Z,{value:"frcs",children:"FRCS"})}),(0,o.jsx)(g,{})]})]})})}function H(){let{input:{onChange:t}}=(0,s.U$)("shots");return(0,o.jsx)(T.Z,{onClick:()=>{t([])},children:"Clear Data"})}function J(){let t=(0,s.U$)("shots"),e=(0,s.U$)("pageImages");return(0,o.jsx)(T.Z,{onClick:()=>{t.input.onChange([]),e.input.onChange([])},children:"Clear All"})}function q(){let t=n.useRef(void 0),e=n.useMemo(()=>d()(e=>{var i;let{values:o}=e;if(o.pageImages!==(null===(i=t.current)||void 0===i?void 0:i.pageImages)&&localStorage.setItem("caveSurveyDataPageImages",JSON.stringify(o.pageImages)),Object.keys(o).some(e=>{var i;return"pageImages"!==e&&o[e]!==(null===(i=t.current)||void 0===i?void 0:i[e])})){let{pageImages:t,...e}=o;localStorage.setItem("caveSurveyDataValues",JSON.stringify(e))}t.current=o},500),[]);return(0,o.jsx)(s.lP,{subscription:{values:!0},onChange:e})}}},function(t){t.O(0,[527,93,412,649,157,744],function(){return t(t.s=2254)}),_N_E=t.O()}]);