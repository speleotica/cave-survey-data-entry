(()=>{"use strict";var t={6038:function(t,e,i){var o=i("2676"),n=i("5271"),l=i("8751");let r=(0,i("4293").Z)({palette:{mode:"light"},components:{MuiAlert:{styleOverrides:{root:t=>{let{ownerState:e}=t;return{..."info"===e.severity&&{backgroundColor:"#60a5fa"}}}}}}});var s=i("7297"),d=i("3198"),a=i("9890"),u=i("9321"),f=i("8209"),c=i.n(f),h=i("3434"),v=i("8891"),g=i("7067");function p(t){return null!=t?h.Unitize.feet(t):void 0}function x(t){return null!=t?h.Unitize.degrees(t):void 0}var m=i("4662"),b=i("7413");let y=b.ZP.object({station:b.ZP.string().trim().optional(),left:b.ZP.number().nonnegative().finite().optional(),right:b.ZP.number().nonnegative().finite().optional(),up:b.ZP.number().nonnegative().finite().optional(),down:b.ZP.number().nonnegative().finite().optional()}),j=b.ZP.number().min(0).lt(360).finite(),w=b.ZP.number().gte(-90).lte(90).finite(),I=b.ZP.object({from:y.optional(),to:y.optional(),isSplit:b.ZP.boolean().optional(),distance:b.ZP.number().positive().nonnegative().finite().optional(),frontsightAzimuth:j.optional(),backsightAzimuth:j.optional(),frontsightInclination:w.optional(),backsightInclination:w.optional(),notes:b.ZP.string().trim().optional()}),Z=b.ZP.enum(["IMO","Lech","FromStaDisAzIncLrUd","ToStaDisAzIncLrUd"]),k=b.ZP.object({x:b.ZP.number(),y:b.ZP.number()}),S=b.ZP.object({topLeft:k,topRight:k,bottomLeft:k,bottomRight:k}),A=b.ZP.object({layoutVariant:Z.optional(),bounds:S.optional(),shots:b.ZP.array(I)}),z=b.ZP.object({imageId:b.ZP.string().uuid(),tables:b.ZP.array(A)}),P=b.ZP.object({outputFormat:b.ZP.enum(["FRCS","Compass","Walls"]).optional(),backsightAzimuthCorrected:b.ZP.boolean().default(!0).optional(),backsightInclinationCorrected:b.ZP.boolean().default(!0).optional(),pages:b.ZP.array(z)}).superRefine((t,e)=>{let{backsightAzimuthCorrected:i,backsightInclinationCorrected:o,pages:n}=t;for(let t=0;t<n.length;t++){let{tables:l}=n[t];for(let n=0;n<l.length;n++){let{shots:r}=l[n];for(let l=0;l<r.length;l++){let{frontsightAzimuth:s,frontsightInclination:d}=r[l],{backsightAzimuth:a,backsightInclination:u}=r[l];if(null!=s&&null!=a){!i&&(a=(a+180)%360);let o=Math.abs(s-a);if(o>=180&&(o=360-o),o>2){let i=[...e.path,"pages",t,"tables",n,"shots",l];e.addIssue({path:[...i,"frontsightAzimuth"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of backsight"}),e.addIssue({path:[...i,"backsightAzimuth"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of frontsight"})}}if(null!=d&&null!=u&&(!o&&(u=-u),Math.abs(d-u)>2)){let i=[...e.path,"pages",t,"tables",n,"shots",l];e.addIssue({path:[...i,"frontsightInclination"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of backsight"}),e.addIssue({path:[...i,"backsightInclination"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of frontsight"})}}}}}),D=(0,m.F)({schema:P});var L=i("5864");function F(t){return null!=t?h.Unitize.feet(t):void 0}function C(t){return null!=t?h.Unitize.degrees(t):void 0}var U=i("1783");function O(t){return null!=t?h.Unitize.feet(t):void 0}function T(t){return null!=t?h.Unitize.degrees(t):void 0}function R(t){let{value:e}=D.useField([]),[i,l]=n.useState(""),r=n.useMemo(()=>c()(t=>{setTimeout(()=>{l("FRCS"===t.outputFormat?function(t){let{pages:e}=t;if(!e.length)return"";let i={name:"Trip",distanceUnit:h.Length.feet,azimuthUnit:h.Angle.degrees,inclinationUnit:h.Angle.degrees},o=[];for(let{tables:t}of e)for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var n,l,r,s,d,a,u,f,c,m,b,y,j,w,I,Z,k,S,A,z,P,D,L,F,C,U,O,T,R,M,B,$,E,_,G,W,V,H;let i=null===(l=e[t])||void 0===l?void 0:null===(n=l.from)||void 0===n?void 0:n.station;if(!i)continue;let h=p(null===(r=e[t])||void 0===r?void 0:r.distance);h&&o.push({from:i,to:(null===(s=e[t+1])||void 0===s?void 0:s.isSplit)?null===(a=e[t+1])||void 0===a?void 0:null===(d=a.to)||void 0===d?void 0:d.station:null===(f=e[t+1])||void 0===f?void 0:null===(u=f.from)||void 0===u?void 0:u.station,kind:v.FrcsShotKind.Normal,distance:h,excludeDistance:!1,frontsightAzimuth:x(null===(c=e[t])||void 0===c?void 0:c.frontsightAzimuth),backsightAzimuth:x(null===(m=e[t])||void 0===m?void 0:m.backsightAzimuth),frontsightInclination:x(null===(b=e[t])||void 0===b?void 0:b.frontsightInclination),backsightInclination:x(null===(y=e[t])||void 0===y?void 0:y.backsightInclination),fromLruds:{left:p(null===(w=e[t])||void 0===w?void 0:null===(j=w.from)||void 0===j?void 0:j.left),right:p(null===(Z=e[t])||void 0===Z?void 0:null===(I=Z.from)||void 0===I?void 0:I.right),up:p(null===(S=e[t])||void 0===S?void 0:null===(k=S.from)||void 0===k?void 0:k.up),down:p(null===(z=e[t])||void 0===z?void 0:null===(A=z.from)||void 0===A?void 0:A.down)},toLruds:(null===(P=e[t+1])||void 0===P?void 0:P.isSplit)?{left:p(null===(L=e[t+1])||void 0===L?void 0:null===(D=L.to)||void 0===D?void 0:D.left),right:p(null===(C=e[t+1])||void 0===C?void 0:null===(F=C.to)||void 0===F?void 0:F.right),up:p(null===(O=e[t+1])||void 0===O?void 0:null===(U=O.to)||void 0===U?void 0:U.up),down:p(null===(R=e[t+1])||void 0===R?void 0:null===(T=R.to)||void 0===T?void 0:T.down)}:{left:p(null===(B=e[t+1])||void 0===B?void 0:null===(M=B.from)||void 0===M?void 0:M.left),right:p(null===(E=e[t+1])||void 0===E?void 0:null===($=E.from)||void 0===$?void 0:$.right),up:p(null===(G=e[t+1])||void 0===G?void 0:null===(_=G.from)||void 0===_?void 0:_.up),down:p(null===(V=e[t+1])||void 0===V?void 0:null===(W=V.from)||void 0===W?void 0:W.down)},comment:null===(H=e[t+1])||void 0===H?void 0:H.notes})}return o.map(t=>(0,g.formatFrcsShot)(t,i)).join("\n")}(t):"Compass"===t.outputFormat?function(t){let{pages:e}=t;if(!e.length)return"";let i={cave:"Cave",name:"Trip",date:new Date,declination:h.Unitize.degrees(0),distanceUnit:L.DistanceUnit.DecimalFeet,azimuthUnit:L.AzimuthUnit.Degrees,inclinationUnit:L.InclinationUnit.Degrees,hasRedundantBacksights:!0,lrudUnit:L.DistanceUnit.DecimalFeet,shotOrder:[L.ShotItem.Distance,L.ShotItem.FrontsightAzimuth,L.ShotItem.BacksightAzimuth,L.ShotItem.FrontsightInclination,L.ShotItem.BacksightInclination],lrudOrder:[L.LrudItem.Left,L.LrudItem.Up,L.LrudItem.Down,L.LrudItem.Right],lrudAssociation:L.LrudAssociation.ToStation},o=[];for(let{tables:t}of e)for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var n,l,r,s,d,a,u,f,c,v,g,p,x,m,b,y,j,w,I,Z,k,S,A,z,P,D,U,O,T,R;let i=null===(l=e[t])||void 0===l?void 0:null===(n=l.from)||void 0===n?void 0:n.station;if(!i)continue;let h=(null===(r=e[t+1])||void 0===r?void 0:r.isSplit)?null===(d=e[t+1])||void 0===d?void 0:null===(s=d.to)||void 0===s?void 0:s.station:null===(u=e[t+1])||void 0===u?void 0:null===(a=u.from)||void 0===a?void 0:a.station;if(!h)continue;let L=F(null===(f=e[t])||void 0===f?void 0:f.distance);L&&o.push({from:i,to:h,distance:L,excludeDistance:!1,frontsightAzimuth:C(null===(c=e[t])||void 0===c?void 0:c.frontsightAzimuth),backsightAzimuth:C(null===(v=e[t])||void 0===v?void 0:v.backsightAzimuth),frontsightInclination:C(null===(g=e[t])||void 0===g?void 0:g.frontsightInclination),backsightInclination:C(null===(p=e[t])||void 0===p?void 0:p.backsightInclination),...(null===(x=e[t+1])||void 0===x?void 0:x.isSplit)?{left:F(null===(b=e[t+1])||void 0===b?void 0:null===(m=b.to)||void 0===m?void 0:m.left),right:F(null===(j=e[t+1])||void 0===j?void 0:null===(y=j.to)||void 0===y?void 0:y.right),up:F(null===(I=e[t+1])||void 0===I?void 0:null===(w=I.to)||void 0===w?void 0:w.up),down:F(null===(k=e[t+1])||void 0===k?void 0:null===(Z=k.to)||void 0===Z?void 0:Z.down)}:{left:F(null===(A=e[t+1])||void 0===A?void 0:null===(S=A.from)||void 0===S?void 0:S.left),right:F(null===(P=e[t+1])||void 0===P?void 0:null===(z=P.from)||void 0===z?void 0:z.right),up:F(null===(U=e[t+1])||void 0===U?void 0:null===(D=U.from)||void 0===D?void 0:D.up),down:F(null===(T=e[t+1])||void 0===T?void 0:null===(O=T.from)||void 0===O?void 0:O.down)},comment:null===(R=e[t+1])||void 0===R?void 0:R.notes})}return(0,L.formatCompassTripHeader)(i)+o.map(t=>(0,L.formatCompassShot)(i)(t)).join("")}(t):"Walls"===t.outputFormat?function(t){let{backsightAzimuthCorrected:e,backsightInclinationCorrected:i,pages:o}=t;if(!o.length)return"";let n=[];for(let{tables:t}of(n.push({type:U.SrvLineType.UnitsDirective,options:[{type:U.UnitsOptionType.DistanceUnit,unit:h.Length.feet},{type:U.UnitsOptionType.FrontsightAzimuthUnit,unit:h.Angle.degrees},{type:U.UnitsOptionType.FrontsightInclinationUnit,unit:h.Angle.degrees},{type:U.UnitsOptionType.Order,order:[U.CompassAndTapeItem.Distance,U.CompassAndTapeItem.Azimuth,U.CompassAndTapeItem.Inclination]},{type:U.UnitsOptionType.LrudStyle,style:U.LrudStyle.ToStationBisector,order:[U.LrudItem.Left,U.LrudItem.Right,U.LrudItem.Up,U.LrudItem.Down]},{type:U.UnitsOptionType.BacksightAzimuthType,isCorrected:e||!1,tolerance:h.Unitize.degrees(2),doNotAverage:!1},{type:U.UnitsOptionType.BacksightInclinationType,isCorrected:i||!1,tolerance:h.Unitize.degrees(2),doNotAverage:!1}]}),o))for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var l,r,s,d,a,u,f,c,v,g,p,x,m,b,y,j,w,I,Z,k,S,A,z,P,D,L,F,C,R,M;let i=null===(r=e[t])||void 0===r?void 0:null===(l=r.from)||void 0===l?void 0:l.station;if(!i)continue;let o=(null===(s=e[t+1])||void 0===s?void 0:s.isSplit)?null===(a=e[t+1])||void 0===a?void 0:null===(d=a.to)||void 0===d?void 0:d.station:null===(f=e[t+1])||void 0===f?void 0:null===(u=f.from)||void 0===u?void 0:u.station;if(!o)continue;let h=O(null===(c=e[t])||void 0===c?void 0:c.distance);h&&n.push({type:U.SrvLineType.Shot,from:i,to:o,measurements:{type:U.ShotType.CompassAndTape,distance:h,frontsightAzimuth:T(null===(v=e[t])||void 0===v?void 0:v.frontsightAzimuth),backsightAzimuth:T(null===(g=e[t])||void 0===g?void 0:g.backsightAzimuth),frontsightInclination:T(null===(p=e[t])||void 0===p?void 0:p.frontsightInclination),backsightInclination:T(null===(x=e[t])||void 0===x?void 0:x.backsightInclination)},...(null===(m=e[t+1])||void 0===m?void 0:m.isSplit)?{left:O(null===(y=e[t+1])||void 0===y?void 0:null===(b=y.to)||void 0===b?void 0:b.left),right:O(null===(w=e[t+1])||void 0===w?void 0:null===(j=w.to)||void 0===j?void 0:j.right),up:O(null===(Z=e[t+1])||void 0===Z?void 0:null===(I=Z.to)||void 0===I?void 0:I.up),down:O(null===(S=e[t+1])||void 0===S?void 0:null===(k=S.to)||void 0===k?void 0:k.down)}:{left:O(null===(z=e[t+1])||void 0===z?void 0:null===(A=z.from)||void 0===A?void 0:A.left),right:O(null===(D=e[t+1])||void 0===D?void 0:null===(P=D.from)||void 0===P?void 0:P.right),up:O(null===(F=e[t+1])||void 0===F?void 0:null===(L=F.from)||void 0===L?void 0:L.up),down:O(null===(R=e[t+1])||void 0===R?void 0:null===(C=R.from)||void 0===C?void 0:C.down)},comment:null===(M=e[t+1])||void 0===M?void 0:M.notes})}return(0,U.formatWallsSrvFile)({lines:n})}(t):"")},0)},500),[]);return n.useEffect(()=>{e&&r(e)},[e]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(u.Z,{multiline:!0,value:i,InputProps:{readOnly:!0,sx:{fontFamily:"monospace"}},...t})})}var M=i("1359"),B=i("1656");function $(t,e){return(0,n.useCallback)(i=>{let{clientX:o,clientY:n}=i;if("object"!=typeof document)return;let{body:l}=document;function r(i){t(i,{dx:i.clientX-o,dy:i.clientY-n,dragStartProps:e})}l&&(l.addEventListener("mousemove",r,!0),l.addEventListener("mouseup",function i(s){l.removeEventListener("mousemove",r,!0),l.removeEventListener("mouseup",i),t(s,{dx:s.clientX-o,dy:s.clientY-n,dragStartProps:e})}),t(i,{dx:0,dy:0,dragStartProps:e}))},[t])}function E(t){var e,i,l;let{sx:r,slotProps:s,children:d,...u}=t,f=n.Children.toArray(d);if(2!==f.length)throw Error("must have two children");let[c,h]=f,[v,g]=n.useState(.5),p=n.useRef(null),x=$((t,e)=>{let{dx:i,dragStartProps:{splitPosition:o}}=e,n=p.current;n&&(t.preventDefault(),t.stopPropagation(),g(o+i/n.offsetWidth))},{splitPosition:v});return(0,o.jsxs)(a.Z,{...u,ref:p,sx:{display:"flex",flexDirection:"row",flexWrap:"nowrap",overflow:"hidden",alignItems:"stretch",...r},children:[(0,o.jsx)(a.Z,{...null==s?void 0:s.left,sx:{flexGrow:0,flexShrink:0,minWidth:0,display:"flex",flexDirection:"column",overflow:"auto",...null==s?void 0:null===(e=s.left)||void 0===e?void 0:e.sx},style:{flexBasis:`${100*v}%`,...null==s?void 0:null===(i=s.left)||void 0===i?void 0:i.style},children:c}),(0,o.jsx)(a.Z,{sx:{width:0,position:"relative"},children:(0,o.jsx)(a.Z,{onMouseDown:x,sx:{position:"absolute",top:0,bottom:0,left:-4,width:8,cursor:"col-resize"}})}),(0,o.jsx)(a.Z,{...null==s?void 0:s.right,sx:{minWidth:0,flexGrow:1,flexShrink:1,flexBasis:0,display:"flex",flexDirection:"column",overflow:"auto",...null==s?void 0:null===(l=s.right)||void 0===l?void 0:l.sx},children:h})]})}var _=i("6336"),G=i("4549"),W=i("7958"),V=i("9002"),H=i.n(V);let N=[t=>{t.createObjectStore("pageImages")}],q=H()(async function(){return await (0,W.X3)("my-db",N.length+1,{upgrade(t,e){for(let i of N.slice(e-1))i(t)}})}),K=n.createContext(void 0);function X(t){let{idb:e,children:i}=t;return(0,o.jsx)(K.Provider,{value:e,children:i})}var J=i("9834"),Y=i("1479"),Q=i("8057");function tt(t){let{label:e,...i}=t;return(0,o.jsxs)(Y.Z,{children:[(0,o.jsx)(Q.Z,{...i}),e]})}function te(t){let{field:e,...i}=t,{input:n}=(0,J.F)({field:e,type:"checkbox"});return(0,o.jsx)(tt,{...n,...i})}var ti=i("9939"),to=i("1831"),tn=i("6261"),tl=i("8028"),tr=i("1930");let ts=n.memo(function(t){let{useFieldProps:e,layoutVariant:i="IMO"}=t,n="FromStaDisAzIncLrUd"===i||"ToStaDisAzIncLrUd"===i?26:11;return(0,o.jsx)(a.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",width:"100%",height:"100%"},children:[...Array(n).keys()].map(t=>(0,o.jsx)(ta,{sx:{flexBasis:`${100/n}%`},index:t,layoutVariant:i,useFieldProps:e,includeShotFields:t<n-1},t))})}),td=["left","right","up","down"],ta=t=>{var e,i,n,l,r,s;let{sx:d,index:u,useFieldProps:f,includeShotFields:c=!0,layoutVariant:h}=t,v=null==f?void 0:null===(e=f.isSplit)||void 0===e?void 0:e.call(f,u),g="FromStaDisAzIncLrUd"===h||"ToStaDisAzIncLrUd"===h,p=!g&&(null==v?void 0:v.value)===!0,x=(null==f?void 0:null===(n=f.isSplit)||void 0===n?void 0:null===(i=n.call(f,u+1))||void 0===i?void 0:i.value)===!0,m="ToStaDisAzIncLrUd"===h?u+1:u,b={position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"19%":"16%","&:not(:hover) > :nth-child(1)":{visibility:"hidden"}};return(0,o.jsxs)(a.Z,{sx:{...d,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[p?(0,o.jsxs)(tu,{sx:b,children:[(0,o.jsx)(ti.Z,{title:"Unsplit row",placement:"right",children:(0,o.jsx)(to.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>{var t;return null==v?void 0:null===(t=v.onChange)||void 0===t?void 0:t.call(v,!1)},children:(0,o.jsx)(tl.Z,{})})}),(0,o.jsx)(tf,{index:u,useFieldProps:null==f?void 0:null===(l=f.to)||void 0===l?void 0:l.station,field:"to.station",above:{field:"from.station",index:u-1},below:{field:"from.station",index:u},right:"distance"}),(0,o.jsx)(tf,{index:u,useFieldProps:null==f?void 0:null===(r=f.from)||void 0===r?void 0:r.station,field:"from.station",below:{field:x?"to.station":"from.station",index:u+1},above:{field:"to.station",index:u},right:"distance"})]}):(0,o.jsxs)(a.Z,{sx:{...b,display:"flex"},children:[g?(0,o.jsx)("span",{}):(0,o.jsx)(ti.Z,{title:"Split row",placement:"right",children:(0,o.jsx)(to.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>{var t;return null==v?void 0:null===(t=v.onChange)||void 0===t?void 0:t.call(v,!0)},children:(0,o.jsx)(tl.Z,{})})}),(0,o.jsx)(tf,{index:m,useFieldProps:null==f?void 0:null===(s=f.from)||void 0===s?void 0:s.station,field:"from.station",above:{field:"from.station",index:m-1},below:{field:x?"to.station":"from.station",index:m+1},right:"distance"})]}),(0,o.jsx)(a.Z,{sx:{position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"37.5%":g?"50%":"40%",pointerEvents:"none"},children:c&&(0,o.jsxs)(a.Z,{sx:{position:"absolute",top:g?"0%":"50%",width:"100%",height:"100%",display:"flex",alignItems:"stretch",pointerEvents:"all"},children:[(0,o.jsx)(tf,{index:u,useFieldProps:null==f?void 0:f.distance,field:"distance",left:"from.station",right:"frontsightAzimuth",sx:{flexBasis:0,flexGrow:1,flexShrink:1}}),(0,o.jsxs)(tu,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,flexDirection:g?"row":"column"},children:[(0,o.jsx)(tc,{index:u,field:"frontsightAzimuth",useFieldProps:null==f?void 0:f.frontsightAzimuth,above:{field:"backsightAzimuth",index:u-1},below:{field:"backsightAzimuth",index:u},left:"distance",right:"frontsightInclination"}),(0,o.jsx)(tc,{index:u,field:"backsightAzimuth",useFieldProps:null==f?void 0:f.backsightAzimuth,above:{field:"frontsightAzimuth",index:u},below:{field:"frontsightAzimuth",index:u+1},left:"distance",right:"backsightInclination"})]}),(0,o.jsxs)(tu,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,flexDirection:g?"row":"column"},children:[(0,o.jsx)(tc,{index:u,field:"frontsightInclination",useFieldProps:null==f?void 0:f.frontsightInclination,above:{field:"backsightInclination",index:u-1},below:{field:"backsightInclination",index:u},left:"frontsightAzimuth",right:"from.left"}),(0,o.jsx)(tc,{index:u,field:"backsightInclination",useFieldProps:null==f?void 0:f.backsightInclination,above:{field:"frontsightInclination",index:u},below:{field:"frontsightInclination",index:u+1},left:"backsightAzimuth",right:{field:x?"to.left":"from.left",index:u+1}})]})]})}),(0,o.jsxs)(a.Z,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[td.map((t,e)=>{var i,n,l;return p?(0,o.jsxs)(tu,{children:[(0,o.jsx)(tf,{index:u,field:`to.${t}`,useFieldProps:null==f?void 0:null===(i=f.to)||void 0===i?void 0:i[t],above:{field:`from.${t}`,index:m-1},below:{field:`from.${t}`,index:m},left:e>0?`to.${td[e-1]}`:{field:"backsightInclination",index:m-1},right:e<3?`to.${td[e+1]}`:"notes"}),(0,o.jsx)(tf,{index:u,field:`from.${t}`,useFieldProps:null==f?void 0:null===(n=f.from)||void 0===n?void 0:n[t],above:{field:`to.${t}`,index:m},below:{field:x?`to.${t}`:`from.${t}`,index:m+1},left:e>0?`from.${td[e-1]}`:"frontsightInclination",right:e<3?`from.${td[e+1]}`:"notes"})]},t):(0,o.jsx)(tf,{index:m,field:`from.${t}`,useFieldProps:null==f?void 0:null===(l=f.from)||void 0===l?void 0:l[t],above:{field:`from.${t}`,index:m-1},below:{field:x?`to.${t}`:`from.${t}`,index:m+1},left:e>0?`from.${td[e-1]}`:"frontsightInclination",right:e<3?`from.${td[e+1]}`:"notes"},t)}),g?void 0:(0,o.jsx)(tf,{index:u,field:"notes",useFieldProps:null==f?void 0:f.notes,sx:{flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"43%":"30%"},left:"from.down"})]})]})};function tu(t){let{sx:e,children:i}=t;return(0,o.jsx)(a.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",...e},children:i})}let tf=t=>{let{field:e,index:i,above:l={field:e,index:i-1},below:r={field:e,index:i+1},left:s,right:d,useFieldProps:a,sx:f,inputProps:c,InputProps:h,...v}=t,{validationError:g,...p}=(null==a?void 0:a(i))||{},x=n.useCallback(t=>{let e;let o=t.target instanceof HTMLInputElement?t.target:void 0;switch(t.key){case"ArrowUp":t.preventDefault(),e=l;break;case"ArrowDown":t.preventDefault(),e=r;break;case"ArrowLeft":(null==o?void 0:o.selectionStart)===0&&(e=s);break;case"ArrowRight":var n;o&&o.selectionEnd===(null===(n=o.value)||void 0===n?void 0:n.length)&&(e=d)}let a="string"==typeof e?document.querySelector(`[data-field="${e}"][data-index="${i}"]`):e?document.querySelector(`[data-field="${e.field}"][data-index="${e.index}"]`):void 0;a instanceof HTMLInputElement&&(t.preventDefault(),a.focus(),a.select())},[e,i]);return(0,o.jsx)(u.Z,{...p,...v,error:null!=g,onKeyDown:x,sx:{flexGrow:1,flexShrink:1,flexBasis:"10%",backgroundColor:(null==p?void 0:p.value)?"rgba(255, 255, 255, 0.8)":"none","& input":{padding:"2px",textAlign:"center"},...f},inputProps:{"data-field":e,"data-index":i,...c},InputProps:{...h,sx:{borderRadius:0,height:"100%",fontSize:"0.8rem",...null==h?void 0:h.sx},endAdornment:g?(0,o.jsx)(tn.Z,{position:"end",sx:{mr:-1.5},children:(0,o.jsx)(ti.Z,{title:g,children:(0,o.jsx)(tr.Z,{sx:{color:"red",height:16,width:16}})})}):void 0}})},tc=t=>{let{sx:e,InputProps:i,...n}=t;return(0,o.jsx)(tf,{...n,sx:{flexGrow:1,flexShrink:1,flexBasis:0,...e},InputProps:{...i,sx:{height:"100%",...null==i?void 0:i.sx}}})};var th=i("3671"),tv=i("6888");function tg(t){let{sx:e,children:i,width:l,height:r,bounds:s,...d}=t,u=n.useMemo(()=>{let t=(0,tv.calculateHomography)([0,0],[s.topLeft.x,s.topLeft.y],[l,0],[s.topRight.x,s.topRight.y],[l,r],[s.bottomRight.x,s.bottomRight.y],[0,r],[s.bottomLeft.x,s.bottomLeft.y]);return`matrix3d(${[t.get([0,0]),t.get([1,0]),0,t.get([2,0]),t.get([0,1]),t.get([1,1]),0,t.get([2,1]),0,0,1,0,t.get([0,2]),t.get([1,2]),0,t.get([2,2])].join(",")})`},[s,l,r]);return(0,o.jsx)(a.Z,{...d,sx:{...e,position:"absolute",top:0,left:0,width:l,height:r,transform:u,transformOrigin:"top left"},children:i})}function tp(t){let{handleSize:e=9,bounds:i,sx:n,onResize:l}=t,r=t=>$((e,i)=>{let{dx:o,dy:n,dragStartProps:{bounds:r}}=i;e.preventDefault(),e.stopPropagation(),l({...r,[t]:{x:r[t].x+o,y:r[t].y+n}})},{bounds:i}),s=t=>{let{x:o,y:n}=t;return{position:"absolute",top:n-i.topLeft.y-Math.ceil(e/2),left:o-i.topLeft.x-Math.ceil(e/2),width:e,height:e,cursor:"grab",backgroundColor:"currentColor",pointerEvents:"all"}};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(a.Z,{sx:{top:i.topLeft.y,left:i.topLeft.x,width:i.bottomRight.x-i.topLeft.x,height:i.bottomRight.y-i.topLeft.y,boxSizing:"border-box",position:"absolute",color:"red",pointerEvents:"none",...n},children:[(0,o.jsx)(a.Z,{sx:s(i.topLeft),onMouseDown:r("topLeft")}),(0,o.jsx)(a.Z,{sx:s(i.topRight),onMouseDown:r("topRight")}),(0,o.jsx)(a.Z,{sx:s(i.bottomRight),onMouseDown:r("bottomRight")}),(0,o.jsx)(a.Z,{sx:s(i.bottomLeft),onMouseDown:r("bottomLeft")})]})})}var tx=i("1059");function tm(t){let{field:e,type:i,...n}=t,{input:l,meta:r}=(0,J.F)({field:e,type:i}),s=r.touched&&null!=r.error;return(0,o.jsx)(u.Z,{...l,error:s,helperText:s?r.error:void 0,...n})}var tb=i("8865");function ty(t){let{field:e,onDelete:i}=t,l=e.get("tables[0]"),{value:r}=(0,tx.U)(e.get("imageId")),s=(0,tb.a)({queryKey:["pageImages",r],queryFn:async()=>{if(!r)return null;let t=await (await q()).get("pageImages",r);return t?await new Promise((e,i)=>{let o=new FileReader;o.readAsDataURL(t),o.onload=()=>{"string"==typeof o.result&&e(o.result)},o.onerror=i}):null}}),{value:d,setValue:u}=(0,tx.U)(l.get("bounds")),{value:f="IMO"}=(0,tx.U)(l.get("layoutVariant")),c=n.useMemo(()=>{let t=t=>e=>{let{input:i,meta:{error:o}}=(0,J.F)({field:t(l.get(["shots",e])),type:"text"});return{...i,...o?{validationError:o}:{}}};return{from:{station:t(t=>t.get("from.station")),left:t(t=>t.get("from.left")),right:t(t=>t.get("from.right")),up:t(t=>t.get("from.up")),down:t(t=>t.get("from.down"))},to:{station:t(t=>t.get("to.station")),left:t(t=>t.get("to.left")),right:t(t=>t.get("to.right")),up:t(t=>t.get("to.up")),down:t(t=>t.get("to.down"))},isSplit:t(t=>t.get("isSplit")),distance:t(t=>t.get("distance")),frontsightAzimuth:t(t=>t.get("frontsightAzimuth")),backsightAzimuth:t(t=>t.get("backsightAzimuth")),frontsightInclination:t(t=>t.get("frontsightInclination")),backsightInclination:t(t=>t.get("backsightInclination")),notes:t(t=>t.get("notes"))}},[l]);return d?(0,o.jsxs)(a.Z,{sx:{position:"relative"},children:[(0,o.jsx)(a.Z,{sx:{userSelect:"none"},children:(0,o.jsx)("img",{src:s.data??void 0,alt:"survey sheet",height:800})}),(0,o.jsxs)(tg,{width:420,height:600,bounds:d,sx:{border:"1px solid red"},children:[(0,o.jsxs)(a.Z,{sx:{position:"absolute",top:-64,left:0,display:"flex",gap:2},children:[(0,o.jsxs)(tm,{variant:"filled",type:"text",field:l.get("layoutVariant"),select:!0,label:"Layout",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)"},children:[(0,o.jsx)(M.Z,{value:"IMO",children:"Inner Mountain Outfitters"}),(0,o.jsx)(M.Z,{value:"Lech",children:"Lechuguilla"}),(0,o.jsx)(M.Z,{value:"FromStaDisAzIncLrUd",children:"From Sta | Dist | Az F/B | Inc F/B | L R | U D"}),(0,o.jsx)(M.Z,{value:"ToStaDisAzIncLrUd",children:"To Sta | Dist | Az F/B | Inc F/B | L R | U D"})]}),(0,o.jsx)(to.Z,{children:(0,o.jsx)(th.Z,{onClick:i})})]}),(0,o.jsx)(ts,{layoutVariant:f,useFieldProps:c})]}),(0,o.jsx)(tp,{bounds:d,onResize:u})]}):null}var tj=i("4933");function tw(){let{elements:t,pushRaw:e,remove:i}=D.useArrayField("pages"),l=function(){let t=n.useContext(K);if(!t)throw Error("must be used inside an IdbProvider");return t}(),r=n.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},[]),s=n.useCallback(async t=>{t.preventDefault();let{files:i}=t.dataTransfer;for(let t of i){let i=tj.Z();await l.add("pageImages",t,i),e({imageId:i,tables:[{layoutVariant:"IMO",bounds:function(t){let{top:e,left:i,width:o,height:n}=t;return{topLeft:{x:i,y:e},topRight:{x:i+o,y:e},bottomLeft:{x:i,y:e+n},bottomRight:{x:i+o,y:e+n}}}({top:113,left:15,width:520,height:632})}]})}},[e]);return(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",overflow:"scroll",flexGrow:1,flexShrink:1,alignSelf:"stretch",minHeight:0},onDragOver:r,onDrop:s,children:[t.map((t,e)=>(0,o.jsx)(ty,{field:t,onDelete:()=>i(e)},e)),t.length?void 0:(0,o.jsx)(a.Z,{sx:{height:200,textAlign:"center",my:10,alignSelf:"stretch",color:"gray"},children:"Drop images here"})]})}let tI=new _.S,{FormProvider:tZ,useInitialize:tk}=D;function tS(){let[t,e]=n.useState();return(q().then(e),t)?(0,o.jsx)(X,{idb:t,children:(0,o.jsx)(G.aH,{client:tI,children:(0,o.jsx)(tZ,{children:(0,o.jsx)(tA,{})})})}):"Loading..."}function tA(){return tk({rawValues:n.useMemo(()=>{try{return P.parse({...JSON.parse(localStorage.getItem("caveSurveyDataValues")||"")})}catch(t){return{outputFormat:"FRCS",backsightAzimuthCorrected:!0,backsightInclinationCorrected:!0,pages:[]}}},[])}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(tD,{}),(0,o.jsxs)(E,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0},slotProps:{right:{sx:{pt:2}}},children:[(0,o.jsxs)(a.Z,{sx:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-start",overflow:"hidden"},children:[(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,o.jsx)(tz,{}),(0,o.jsx)(tP,{})]}),(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"row",gap:4,mb:2},children:[(0,o.jsx)(te,{field:D.get("backsightAzimuthCorrected"),label:"Corrected Backsight Azimuths"}),(0,o.jsx)(te,{field:D.get("backsightInclinationCorrected"),label:"Corrected Backsight Inclinations"})]}),(0,o.jsx)(tw,{})]}),(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,o.jsxs)(tm,{field:D.get("outputFormat"),type:"text",label:"Format",select:!0,fullWidth:!0,children:[(0,o.jsx)(M.Z,{value:"FRCS",children:"FRCS"}),(0,o.jsx)(M.Z,{value:"Compass",children:"Compass"}),(0,o.jsx)(M.Z,{value:"Walls",children:"Walls"})]}),(0,o.jsx)(R,{fullWidth:!0,sx:{flexGrow:1,flexShrink:1,minHeight:0,mt:2}})]})]})]})}function tz(){let{value:t,setValue:e}=D.useField("pages");return(0,o.jsx)(B.Z,{onClick:()=>{e((t||[]).map(t=>{var e;return{...t,tables:null===(e=t.tables)||void 0===e?void 0:e.map(t=>({...t,shots:[]}))}}))},children:"Clear Data"})}function tP(){let{setValue:t}=D.useField("pages");return(0,o.jsx)(B.Z,{onClick:()=>{t([])},children:"Clear All"})}function tD(){let{rawValue:t}=D.useField([]),e=n.useMemo(()=>c()(t=>{localStorage.setItem("caveSurveyDataValues",JSON.stringify(t))},500),[]);return n.useEffect(()=>{t&&e(t)},[t]),null}let tL=document.getElementById("root");tL&&(0,l.createRoot)(tL).render((0,o.jsx)(function(){return(0,o.jsxs)(s.Z,{theme:r,children:[(0,o.jsx)(d.ZP,{}),(0,o.jsx)(tS,{})]})},{}))}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var l=e[o]={id:o,loaded:!1,exports:{}};return t[o].call(l.exports,l,l.exports,i),l.loaded=!0,l.exports}i.m=t,i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?function(t){return Object.getPrototypeOf(t)}:function(t){return t.__proto__};i.t=function(o,n){if(1&n&&(o=this(o)),8&n||"object"==typeof o&&o&&(4&n&&o.__esModule||16&n&&"function"==typeof o.then))return o;var l=Object.create(null);i.r(l);var r={};t=t||[null,e({}),e([]),e(e)];for(var s=2&n&&o;"object"==typeof s&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach(function(t){r[t]=function(){return o[t]}});return r.default=function(){return o},i.d(l,r),l}})(),i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=function(t){return t.paths=[],!t.children&&(t.children=[]),t},(()=>{var t=[];i.O=function(e,o,n,l){if(o){l=l||0;for(var r=t.length;r>0&&t[r-1][2]>l;r--)t[r]=t[r-1];t[r]=[o,n,l];return}for(var s=1/0,r=0;r<t.length;r++){for(var o=t[r][0],n=t[r][1],l=t[r][2],d=!0,a=0;a<o.length;a++)(!1&l||s>=l)&&Object.keys(i.O).every(function(t){return i.O[t](o[a])})?o.splice(a--,1):(d=!1,l<s&&(s=l));if(d){t.splice(r--,1);var u=n();void 0!==u&&(e=u)}}return e}})(),i.rv=function(){return"1.0.0-rc.0"},(()=>{var t={980:0};i.O.j=function(e){return 0===t[e]};var e=function(e,o){var n=o[0],l=o[1],r=o[2],s,d,a=0;if(n.some(function(e){return 0!==t[e]})){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(r)var u=r(i)}for(e&&e(o);a<n.length;a++)d=n[a],i.o(t,d)&&t[d]&&t[d][0](),t[d]=0;return i.O(u)},o=self.webpackChunk_speleotica_cave_survey_data_entry=self.webpackChunk_speleotica_cave_survey_data_entry||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})(),i.ruid="bundler=rspack@1.0.0-rc.0";var o=i.O(void 0,["707","361","809"],function(){return i("6038")});o=i.O(o)})();