(()=>{"use strict";var t={420:function(t,e,i){var n=i(4752),l=i(5271),o=i(8751);let r=(0,i(4293).Z)({palette:{mode:"light"},components:{MuiAlert:{styleOverrides:{root:t=>{let{ownerState:e}=t;return{..."info"===e.severity&&{backgroundColor:"#60a5fa"}}}}}}});var a=i(7297),s=i(3198),u=i(8548),d=i(9890),f=i(9321),c=i(8209),h=i.n(c),g=i(6187),p=i(8091),m=i(5712);function v(t){return null!=t?g.Unitize.feet(t):void 0}function x(t){return null!=t?g.Unitize.degrees(t):void 0}var b=i(7413);let Z=b.ZP.object({station:b.ZP.string().trim().optional(),left:b.ZP.number().nonnegative().finite().optional(),right:b.ZP.number().nonnegative().finite().optional(),up:b.ZP.number().nonnegative().finite().optional(),down:b.ZP.number().nonnegative().finite().optional()}),y=b.ZP.number().min(0).lt(360).finite(),w=b.ZP.number().gte(-90).lte(90).finite(),I=b.ZP.object({from:Z.optional(),to:Z.optional(),isSplit:b.ZP.boolean().optional(),distance:b.ZP.number().positive().nonnegative().finite().optional(),frontsightAzimuth:y.optional(),backsightAzimuth:y.optional(),frontsightInclination:w.optional(),backsightInclination:w.optional(),notes:b.ZP.string().trim().optional()}),k=b.ZP.enum(["IMO","Lech","FromStaDisAzIncLrUd","ToStaDisAzIncLrUd"]),S=b.ZP.object({x:b.ZP.number(),y:b.ZP.number()}),A=b.ZP.object({topLeft:S,topRight:S,bottomLeft:S,bottomRight:S}),z=b.ZP.object({layoutVariant:k.optional(),bounds:A.optional(),shots:b.ZP.array(I.optional()).default([])}),P=b.ZP.object({imageId:b.ZP.string().uuid(),tables:b.ZP.array(z).default([])}),D=b.ZP.object({outputFormat:b.ZP.enum(["FRCS","Compass","Walls"]).optional(),backsightAzimuthCorrected:b.ZP.boolean().default(!0).optional(),backsightInclinationCorrected:b.ZP.boolean().default(!0).optional(),pages:b.ZP.array(P).default([])}).superRefine((t,e)=>{let{backsightAzimuthCorrected:i,backsightInclinationCorrected:n,pages:l}=t;for(let t=0;t<l.length;t++){let{tables:o}=l[t];for(let l=0;l<o.length;l++){let{shots:r}=o[l];for(let o=0;o<r.length;o++){let a=r[o];if(!a)continue;let{frontsightAzimuth:s,frontsightInclination:u}=a,{backsightAzimuth:d,backsightInclination:f}=a;if(null!=s&&null!=d){i||(d=(d+180)%360);let n=Math.abs(s-d);if(n>=180&&(n=360-n),n>2){let i=[...e.path,"pages",t,"tables",l,"shots",o];e.addIssue({path:[...i,"frontsightAzimuth"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of backsight"}),e.addIssue({path:[...i,"backsightAzimuth"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of frontsight"})}}if(null!=u&&null!=f&&(n||(f=-f),Math.abs(u-f)>2)){let i=[...e.path,"pages",t,"tables",l,"shots",o];e.addIssue({path:[...i,"frontsightInclination"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of backsight"}),e.addIssue({path:[...i,"backsightInclination"],code:b.ZP.ZodIssueCode.custom,message:"must be within 2 degrees of frontsight"})}}}}}),F=(0,i(8699).F)({schema:D});var L=i(4824);function C(t){return null!=t?g.Unitize.feet(t):void 0}function B(t){return null!=t?g.Unitize.degrees(t):void 0}var U=i(1781);function O(t){return null!=t?g.Unitize.feet(t):void 0}function T(t){return null!=t?g.Unitize.degrees(t):void 0}function R(t){let{value:e}=F.useField([]),[i,o]=l.useState(""),r=l.useMemo(()=>h()(t=>{setTimeout(()=>{o("FRCS"===t.outputFormat?function(t){let{pages:e}=t;if(!e.length)return"";let i={name:"Trip",distanceUnit:g.Length.feet,azimuthUnit:g.Angle.degrees,inclinationUnit:g.Angle.degrees},n=[];for(let{tables:t}of e)for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var l,o,r,a,s,u,d,f,c,h,b,Z,y,w,I,k,S,A,z,P,D,F,L,C,B,U,O,T,R,j,M,X,$,E,_,G,H,W;let i=null==(o=e[t])||null==(l=o.from)?void 0:l.station;if(!i)continue;let g=v(null==(r=e[t])?void 0:r.distance);g&&n.push({from:i,to:(null==(a=e[t+1])?void 0:a.isSplit)?null==(u=e[t+1])||null==(s=u.to)?void 0:s.station:null==(f=e[t+1])||null==(d=f.from)?void 0:d.station,kind:p.FrcsShotKind.Normal,distance:g,excludeDistance:!1,frontsightAzimuth:x(null==(c=e[t])?void 0:c.frontsightAzimuth),backsightAzimuth:x(null==(h=e[t])?void 0:h.backsightAzimuth),frontsightInclination:x(null==(b=e[t])?void 0:b.frontsightInclination),backsightInclination:x(null==(Z=e[t])?void 0:Z.backsightInclination),fromLruds:{left:v(null==(w=e[t])||null==(y=w.from)?void 0:y.left),right:v(null==(k=e[t])||null==(I=k.from)?void 0:I.right),up:v(null==(A=e[t])||null==(S=A.from)?void 0:S.up),down:v(null==(P=e[t])||null==(z=P.from)?void 0:z.down)},toLruds:(null==(D=e[t+1])?void 0:D.isSplit)?{left:v(null==(L=e[t+1])||null==(F=L.to)?void 0:F.left),right:v(null==(B=e[t+1])||null==(C=B.to)?void 0:C.right),up:v(null==(O=e[t+1])||null==(U=O.to)?void 0:U.up),down:v(null==(R=e[t+1])||null==(T=R.to)?void 0:T.down)}:{left:v(null==(M=e[t+1])||null==(j=M.from)?void 0:j.left),right:v(null==($=e[t+1])||null==(X=$.from)?void 0:X.right),up:v(null==(_=e[t+1])||null==(E=_.from)?void 0:E.up),down:v(null==(H=e[t+1])||null==(G=H.from)?void 0:G.down)},comment:null==(W=e[t+1])?void 0:W.notes})}return n.map(t=>(0,m.formatFrcsShot)(t,i)).join("\n")}(t):"Compass"===t.outputFormat?function(t){let{pages:e}=t;if(!e.length)return"";let i={cave:"Cave",name:"Trip",date:new Date,declination:g.Unitize.degrees(0),distanceUnit:L.DistanceUnit.DecimalFeet,azimuthUnit:L.AzimuthUnit.Degrees,inclinationUnit:L.InclinationUnit.Degrees,hasRedundantBacksights:!0,lrudUnit:L.DistanceUnit.DecimalFeet,shotOrder:[L.ShotItem.Distance,L.ShotItem.FrontsightAzimuth,L.ShotItem.BacksightAzimuth,L.ShotItem.FrontsightInclination,L.ShotItem.BacksightInclination],lrudOrder:[L.LrudItem.Left,L.LrudItem.Up,L.LrudItem.Down,L.LrudItem.Right],lrudAssociation:L.LrudAssociation.ToStation},n=[];for(let{tables:t}of e)for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var l,o,r,a,s,u,d,f,c,h,p,m,v,x,b,Z,y,w,I,k,S,A,z,P,D,F,U,O,T,R;let i=null==(o=e[t])||null==(l=o.from)?void 0:l.station;if(!i)continue;let g=(null==(r=e[t+1])?void 0:r.isSplit)?null==(s=e[t+1])||null==(a=s.to)?void 0:a.station:null==(d=e[t+1])||null==(u=d.from)?void 0:u.station;if(!g)continue;let L=C(null==(f=e[t])?void 0:f.distance);L&&n.push({from:i,to:g,distance:L,excludeDistance:!1,frontsightAzimuth:B(null==(c=e[t])?void 0:c.frontsightAzimuth),backsightAzimuth:B(null==(h=e[t])?void 0:h.backsightAzimuth),frontsightInclination:B(null==(p=e[t])?void 0:p.frontsightInclination),backsightInclination:B(null==(m=e[t])?void 0:m.backsightInclination),...(null==(v=e[t+1])?void 0:v.isSplit)?{left:C(null==(b=e[t+1])||null==(x=b.to)?void 0:x.left),right:C(null==(y=e[t+1])||null==(Z=y.to)?void 0:Z.right),up:C(null==(I=e[t+1])||null==(w=I.to)?void 0:w.up),down:C(null==(S=e[t+1])||null==(k=S.to)?void 0:k.down)}:{left:C(null==(z=e[t+1])||null==(A=z.from)?void 0:A.left),right:C(null==(D=e[t+1])||null==(P=D.from)?void 0:P.right),up:C(null==(U=e[t+1])||null==(F=U.from)?void 0:F.up),down:C(null==(T=e[t+1])||null==(O=T.from)?void 0:O.down)},comment:null==(R=e[t+1])?void 0:R.notes})}return(0,L.formatCompassTripHeader)(i)+n.map(t=>(0,L.formatCompassShot)(i)(t)).join("")}(t):"Walls"===t.outputFormat?function(t){let{backsightAzimuthCorrected:e,backsightInclinationCorrected:i,pages:n}=t;if(!n.length)return"";let l=[];for(let{tables:t}of(l.push({type:U.SrvLineType.UnitsDirective,options:[{type:U.UnitsOptionType.DistanceUnit,unit:g.Length.feet},{type:U.UnitsOptionType.FrontsightAzimuthUnit,unit:g.Angle.degrees},{type:U.UnitsOptionType.FrontsightInclinationUnit,unit:g.Angle.degrees},{type:U.UnitsOptionType.Order,order:[U.CompassAndTapeItem.Distance,U.CompassAndTapeItem.Azimuth,U.CompassAndTapeItem.Inclination]},{type:U.UnitsOptionType.LrudStyle,style:U.LrudStyle.ToStationBisector,order:[U.LrudItem.Left,U.LrudItem.Right,U.LrudItem.Up,U.LrudItem.Down]},{type:U.UnitsOptionType.BacksightAzimuthType,isCorrected:e||!1,tolerance:g.Unitize.degrees(2),doNotAverage:!1},{type:U.UnitsOptionType.BacksightInclinationType,isCorrected:i||!1,tolerance:g.Unitize.degrees(2),doNotAverage:!1}]}),n))for(let{shots:e}of t)for(let t=0;t<e.length-1;t++){var o,r,a,s,u,d,f,c,h,p,m,v,x,b,Z,y,w,I,k,S,A,z,P,D,F,L,C,B,R,j;let i=null==(r=e[t])||null==(o=r.from)?void 0:o.station;if(!i)continue;let n=(null==(a=e[t+1])?void 0:a.isSplit)?null==(u=e[t+1])||null==(s=u.to)?void 0:s.station:null==(f=e[t+1])||null==(d=f.from)?void 0:d.station;if(!n)continue;let g=O(null==(c=e[t])?void 0:c.distance);g&&l.push({type:U.SrvLineType.Shot,from:i,to:n,measurements:{type:U.ShotType.CompassAndTape,distance:g,frontsightAzimuth:T(null==(h=e[t])?void 0:h.frontsightAzimuth),backsightAzimuth:T(null==(p=e[t])?void 0:p.backsightAzimuth),frontsightInclination:T(null==(m=e[t])?void 0:m.frontsightInclination),backsightInclination:T(null==(v=e[t])?void 0:v.backsightInclination)},...(null==(x=e[t+1])?void 0:x.isSplit)?{left:O(null==(Z=e[t+1])||null==(b=Z.to)?void 0:b.left),right:O(null==(w=e[t+1])||null==(y=w.to)?void 0:y.right),up:O(null==(k=e[t+1])||null==(I=k.to)?void 0:I.up),down:O(null==(A=e[t+1])||null==(S=A.to)?void 0:S.down)}:{left:O(null==(P=e[t+1])||null==(z=P.from)?void 0:z.left),right:O(null==(F=e[t+1])||null==(D=F.from)?void 0:D.right),up:O(null==(C=e[t+1])||null==(L=C.from)?void 0:L.up),down:O(null==(R=e[t+1])||null==(B=R.from)?void 0:B.down)},comment:null==(j=e[t+1])?void 0:j.notes})}return(0,U.formatWallsSrvFile)({lines:l})}(t):"")},0)},500),[]);return l.useEffect(()=>{let t=D.safeParse(e);t.success&&r(t.data)},[e]),(0,n.tZ)(n.HY,{children:(0,n.tZ)(f.Z,{multiline:!0,value:i,InputProps:{readOnly:!0,sx:{fontFamily:"monospace"}},...t})})}var j=i(1359),M=i(1656);function X(t,e){return(0,l.useCallback)(i=>{let{clientX:n,clientY:l}=i;if("object"!=typeof document)return;let{body:o}=document;function r(i){t(i,{dx:i.clientX-n,dy:i.clientY-l,dragStartProps:e})}o&&(o.addEventListener("mousemove",r,!0),o.addEventListener("mouseup",function i(a){o.removeEventListener("mousemove",r,!0),o.removeEventListener("mouseup",i),t(a,{dx:a.clientX-n,dy:a.clientY-l,dragStartProps:e})}),t(i,{dx:0,dy:0,dragStartProps:e}))},[t])}function $(t){var e,i,o;let{sx:r,slotProps:a,children:s,...u}=t,f=l.Children.toArray(s);if(2!==f.length)throw Error("must have two children");let[c,h]=f,[g,p]=l.useState(.5),m=l.useRef(null),v=X((t,e)=>{let{dx:i,dragStartProps:{splitPosition:n}}=e,l=m.current;l&&(t.preventDefault(),t.stopPropagation(),p(n+i/l.offsetWidth))},{splitPosition:g});return(0,n.BX)(d.Z,{...u,ref:m,sx:{display:"flex",flexDirection:"row",flexWrap:"nowrap",overflow:"hidden",alignItems:"stretch",...r},children:[(0,n.tZ)(d.Z,{...null==a?void 0:a.left,sx:{flexGrow:0,flexShrink:0,minWidth:0,display:"flex",flexDirection:"column",overflow:"auto",...null==a||null==(e=a.left)?void 0:e.sx},style:{flexBasis:`${100*g}%`,...null==a||null==(i=a.left)?void 0:i.style},children:c}),(0,n.tZ)(d.Z,{sx:{width:0,position:"relative"},children:(0,n.tZ)(d.Z,{onMouseDown:v,sx:{position:"absolute",top:0,bottom:0,left:-4,width:8,cursor:"col-resize"}})}),(0,n.tZ)(d.Z,{...null==a?void 0:a.right,sx:{minWidth:0,flexGrow:1,flexShrink:1,flexBasis:0,display:"flex",flexDirection:"column",overflow:"auto",...null==a||null==(o=a.right)?void 0:o.sx},children:h})]})}var E=i(6336),_=i(4549),G=i(7958),H=i(9002),W=i.n(H);let V=[t=>{t.createObjectStore("pageImages")}],N=W()(async function(){return await (0,G.X3)("my-db",V.length+1,{upgrade(t,e){for(let i of V.slice(e-1))i(t)}})}),Y=l.createContext(void 0);function q(t){let{idb:e,children:i}=t;return(0,n.tZ)(Y.Provider,{value:e,children:i})}var K=i(1810),J=i(1479),Q=i(8057);function tt(t){let{label:e,...i}=t;return(0,n.BX)(J.Z,{children:[(0,n.tZ)(Q.Z,{...i}),e]})}function te(t){let{field:e,...i}=t,{input:l}=(0,K.useHtmlField)({field:e,type:"checkbox"});return(0,n.tZ)(tt,{...l,...i})}var ti=i(9939),tn=i(1831),tl=i(6261),to=i(8028),tr=i(1930);let ta=l.memo(function(t){let{useFieldProps:e,layoutVariant:i="IMO"}=t,l="FromStaDisAzIncLrUd"===i||"ToStaDisAzIncLrUd"===i?26:11;return(0,n.tZ)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",width:"100%",height:"100%"},"data-component":"SurveyPageFields",children:[...Array(l).keys()].map(t=>(0,n.tZ)(tu,{sx:{flexBasis:`${100/l}%`},index:t,layoutVariant:i,useFieldProps:e,includeShotFields:t<l-1},t))})}),ts=["left","right","up","down"],tu=t=>{var e,i,l,o,r,a;let{sx:s,index:u,useFieldProps:f,includeShotFields:c=!0,layoutVariant:h}=t,g=null==f||null==(e=f.isSplit)?void 0:e.call(f,u),p="FromStaDisAzIncLrUd"===h||"ToStaDisAzIncLrUd"===h,m=!p&&(null==g?void 0:g.value)===!0,v=(null==f||null==(l=f.isSplit)||null==(i=l.call(f,u+1))?void 0:i.value)===!0,x="ToStaDisAzIncLrUd"===h?u+1:u,b={position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"19%":"16%","&:not(:hover) > :nth-child(1)":{visibility:"hidden"}};return(0,n.BX)(d.Z,{sx:{...s,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[m?(0,n.BX)(td,{sx:b,children:[(0,n.tZ)(ti.Z,{title:"Unsplit row",placement:"right",children:(0,n.tZ)(tn.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>null==g?void 0:g.setValue(!1),children:(0,n.tZ)(to.Z,{})})}),(0,n.tZ)(tf,{index:u,useFieldProps:null==f||null==(o=f.to)?void 0:o.station,field:"to.station",above:{field:"from.station",index:u-1},below:{field:"from.station",index:u},right:"distance"}),(0,n.tZ)(tf,{index:u,useFieldProps:null==f||null==(r=f.from)?void 0:r.station,field:"from.station",below:{field:v?"to.station":"from.station",index:u+1},above:{field:"to.station",index:u},right:"distance"})]}):(0,n.BX)(d.Z,{sx:{...b,display:"flex"},children:[p?(0,n.tZ)("span",{}):(0,n.tZ)(ti.Z,{title:"Split row",placement:"right",children:(0,n.tZ)(tn.Z,{size:"small",tabIndex:-1,sx:{position:"absolute",top:"50%",left:0,mt:-2,ml:-2,height:32,width:32,minHeight:32},onClick:()=>null==g?void 0:g.setValue(!0),children:(0,n.tZ)(to.Z,{})})}),(0,n.tZ)(tf,{index:x,useFieldProps:null==f||null==(a=f.from)?void 0:a.station,field:"from.station",above:{field:"from.station",index:x-1},below:{field:v?"to.station":"from.station",index:x+1},right:"distance"})]}),(0,n.tZ)(d.Z,{sx:{position:"relative",flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"37.5%":p?"50%":"40%",pointerEvents:"none"},children:c&&(0,n.BX)(d.Z,{sx:{position:"absolute",top:p?"0%":"50%",width:"100%",height:"100%",display:"flex",alignItems:"stretch",pointerEvents:"all"},children:[(0,n.tZ)(tf,{index:u,useFieldProps:null==f?void 0:f.distance,field:"distance",left:"from.station",right:"frontsightAzimuth",sx:{flexBasis:0,flexGrow:1,flexShrink:1}}),(0,n.BX)(td,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,flexDirection:p?"row":"column"},children:[(0,n.tZ)(tc,{index:u,field:"frontsightAzimuth",useFieldProps:null==f?void 0:f.frontsightAzimuth,above:{field:"backsightAzimuth",index:u-1},below:{field:"backsightAzimuth",index:u},left:"distance",right:"frontsightInclination"}),(0,n.tZ)(tc,{index:u,field:"backsightAzimuth",useFieldProps:null==f?void 0:f.backsightAzimuth,above:{field:"frontsightAzimuth",index:u},below:{field:"frontsightAzimuth",index:u+1},left:"distance",right:"backsightInclination"})]}),(0,n.BX)(td,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,flexDirection:p?"row":"column"},children:[(0,n.tZ)(tc,{index:u,field:"frontsightInclination",useFieldProps:null==f?void 0:f.frontsightInclination,above:{field:"backsightInclination",index:u-1},below:{field:"backsightInclination",index:u},left:"frontsightAzimuth",right:"from.left"}),(0,n.tZ)(tc,{index:u,field:"backsightInclination",useFieldProps:null==f?void 0:f.backsightInclination,above:{field:"frontsightInclination",index:u},below:{field:"frontsightInclination",index:u+1},left:"backsightAzimuth",right:{field:v?"to.left":"from.left",index:u+1}})]})]})}),(0,n.BX)(d.Z,{sx:{flexBasis:0,flexGrow:1,flexShrink:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"stretch"},children:[ts.map((t,e)=>{var i,l,o;return m?(0,n.BX)(td,{children:[(0,n.tZ)(tf,{index:u,field:`to.${t}`,useFieldProps:null==f||null==(i=f.to)?void 0:i[t],above:{field:`from.${t}`,index:x-1},below:{field:`from.${t}`,index:x},left:e>0?`to.${ts[e-1]}`:{field:"backsightInclination",index:x-1},right:e<3?`to.${ts[e+1]}`:"notes"}),(0,n.tZ)(tf,{index:u,field:`from.${t}`,useFieldProps:null==f||null==(l=f.from)?void 0:l[t],above:{field:`to.${t}`,index:x},below:{field:v?`to.${t}`:`from.${t}`,index:x+1},left:e>0?`from.${ts[e-1]}`:"frontsightInclination",right:e<3?`from.${ts[e+1]}`:"notes"})]},t):(0,n.tZ)(tf,{index:x,field:`from.${t}`,useFieldProps:null==f||null==(o=f.from)?void 0:o[t],above:{field:`from.${t}`,index:x-1},below:{field:v?`to.${t}`:`from.${t}`,index:x+1},left:e>0?`from.${ts[e-1]}`:"frontsightInclination",right:e<3?`from.${ts[e+1]}`:"notes"},t)}),p?void 0:(0,n.tZ)(tf,{index:u,field:"notes",useFieldProps:null==f?void 0:f.notes,sx:{flexGrow:0,flexShrink:0,flexBasis:"Lech"===h?"43%":"30%"},left:"from.down"})]})]})};function td(t){let{sx:e,children:i}=t;return(0,n.tZ)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch",...e},children:i})}let tf=t=>{let{field:e,index:i,above:o={field:e,index:i-1},below:r={field:e,index:i+1},left:a,right:s,useFieldProps:u,sx:d,inputProps:c,InputProps:h,...g}=t,{validationError:p,...m}=(null==u?void 0:u(i))||{},v=l.useCallback(t=>{let e,n=t.target instanceof HTMLInputElement?t.target:void 0;switch(t.key){case"ArrowUp":t.preventDefault(),e=o;break;case"ArrowDown":t.preventDefault(),e=r;break;case"ArrowLeft":(null==n?void 0:n.selectionStart)===0&&(e=a);break;case"ArrowRight":var l;n&&n.selectionEnd===(null==(l=n.value)?void 0:l.length)&&(e=s)}let u=null==n?void 0:n.closest('[data-component="SurveyPageFields"]'),d="string"==typeof e?null==u?void 0:u.querySelector(`[data-field="${e}"][data-index="${i}"]`):e?null==u?void 0:u.querySelector(`[data-field="${e.field}"][data-index="${e.index}"]`):void 0;d instanceof HTMLInputElement&&(t.preventDefault(),d.focus(),d.select())},[e,i]);return(0,n.tZ)(f.Z,{...m,...g,error:null!=p,onKeyDown:v,sx:{flexGrow:1,flexShrink:1,flexBasis:"10%",backgroundColor:(null==m?void 0:m.value)?"rgba(255, 255, 255, 0.8)":"none","& input":{padding:"2px",textAlign:"center"},...d},inputProps:{"data-field":e,"data-index":i,...c},InputProps:{...h,disableInjectingGlobalStyles:!0,sx:{borderRadius:0,height:"100%",fontSize:"0.8rem",...null==h?void 0:h.sx},endAdornment:p?(0,n.tZ)(tl.Z,{position:"end",sx:{mr:-1.5},children:(0,n.tZ)(ti.Z,{title:p,children:(0,n.tZ)(tr.Z,{sx:{color:"red",height:16,width:16}})})}):void 0}})},tc=t=>{let{sx:e,InputProps:i,...l}=t;return(0,n.tZ)(tf,{...l,sx:{flexGrow:1,flexShrink:1,flexBasis:0,...e},InputProps:{...i,sx:{height:"100%",...null==i?void 0:i.sx}}})};var th=i(3671),tg=i(6888);function tp(t){let{sx:e,children:i,width:o,height:r,bounds:a,...s}=t,u=l.useMemo(()=>{let t=(0,tg.calculateHomography)([0,0],[a.topLeft.x,a.topLeft.y],[o,0],[a.topRight.x,a.topRight.y],[o,r],[a.bottomRight.x,a.bottomRight.y],[0,r],[a.bottomLeft.x,a.bottomLeft.y]);return`matrix3d(${[t.get([0,0]),t.get([1,0]),0,t.get([2,0]),t.get([0,1]),t.get([1,1]),0,t.get([2,1]),0,0,1,0,t.get([0,2]),t.get([1,2]),0,t.get([2,2])].join(",")})`},[a,o,r]);return(0,n.tZ)(d.Z,{...s,sx:{...e,position:"absolute",top:0,left:0,width:o,height:r,transform:u,transformOrigin:"top left"},children:i})}function tm(t){let{handleSize:e=9,bounds:i,sx:l,onResize:o}=t,r=t=>X((e,i)=>{let{dx:n,dy:l,dragStartProps:{bounds:r}}=i;e.preventDefault(),e.stopPropagation(),o({...r,[t]:{x:r[t].x+n,y:r[t].y+l}})},{bounds:i}),a=t=>{let{x:n,y:l}=t;return{position:"absolute",top:l-i.topLeft.y-Math.ceil(e/2),left:n-i.topLeft.x-Math.ceil(e/2),width:e,height:e,cursor:"grab",backgroundColor:"currentColor",pointerEvents:"all"}};return(0,n.tZ)(n.HY,{children:(0,n.BX)(d.Z,{sx:{top:i.topLeft.y,left:i.topLeft.x,width:i.bottomRight.x-i.topLeft.x,height:i.bottomRight.y-i.topLeft.y,boxSizing:"border-box",position:"absolute",color:"red",pointerEvents:"none",...l},children:[(0,n.tZ)(d.Z,{sx:a(i.topLeft),onMouseDown:r("topLeft")}),(0,n.tZ)(d.Z,{sx:a(i.topRight),onMouseDown:r("topRight")}),(0,n.tZ)(d.Z,{sx:a(i.bottomRight),onMouseDown:r("bottomRight")}),(0,n.tZ)(d.Z,{sx:a(i.bottomLeft),onMouseDown:r("bottomLeft")})]})})}var tv=i(9559);function tx(t){let{field:e,type:i,...l}=t,{input:o,meta:r}=(0,K.useHtmlField)({field:e,type:i}),a=r.touched&&null!=r.error;return(0,n.tZ)(f.Z,{...o,error:a,helperText:a?r.error:void 0,...l})}var tb=i(8865);function tZ(t){let{field:e,onDelete:i}=t,o=e.get("tables[0]"),{value:r}=(0,tv.useField)(e.get("imageId")),a=(0,tb.a)({queryKey:["pageImages",r],queryFn:async()=>{if(!r)return null;let t=await (await N()).get("pageImages",r);return t?await new Promise((e,i)=>{let n=new FileReader;n.readAsDataURL(t),n.onload=()=>{"string"==typeof n.result&&e(n.result)},n.onerror=i}):null}}),{parsedValue:s,setValue:u}=(0,tv.useField)(o.get("bounds")),{value:f="IMO"}=(0,tv.useField)(o.get("layoutVariant")),c=l.useMemo(()=>{let t,e=t=>e=>{let{input:i,meta:{error:n}}=(0,K.useHtmlField)({field:t(o.get(["shots",e])),type:"text"});return{...i,...n?{validationError:n}:{}}};return{from:{station:e(t=>t.get("from.station")),left:e(t=>t.get("from.left")),right:e(t=>t.get("from.right")),up:e(t=>t.get("from.up")),down:e(t=>t.get("from.down"))},to:{station:e(t=>t.get("to.station")),left:e(t=>t.get("to.left")),right:e(t=>t.get("to.right")),up:e(t=>t.get("to.up")),down:e(t=>t.get("to.down"))},isSplit:(t=t=>t.get("isSplit"),e=>(0,tv.useField)(t(o.get(["shots",e])))),distance:e(t=>t.get("distance")),frontsightAzimuth:e(t=>t.get("frontsightAzimuth")),backsightAzimuth:e(t=>t.get("backsightAzimuth")),frontsightInclination:e(t=>t.get("frontsightInclination")),backsightInclination:e(t=>t.get("backsightInclination")),notes:e(t=>t.get("notes"))}},[o]);return s?(0,n.BX)(d.Z,{sx:{position:"relative"},children:[(0,n.tZ)(d.Z,{sx:{userSelect:"none"},children:(0,n.tZ)("img",{src:a.data??void 0,alt:"survey sheet",height:800})}),(0,n.BX)(tp,{width:420,height:600,bounds:s,sx:{border:"1px solid red"},children:[(0,n.BX)(d.Z,{sx:{position:"absolute",top:-64,left:0,display:"flex",gap:2},children:[(0,n.BX)(tx,{variant:"filled",type:"text",field:o.get("layoutVariant"),select:!0,label:"Layout",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)"},children:[(0,n.tZ)(j.Z,{value:"IMO",children:"Inner Mountain Outfitters"}),(0,n.tZ)(j.Z,{value:"Lech",children:"Lechuguilla"}),(0,n.tZ)(j.Z,{value:"FromStaDisAzIncLrUd",children:"From Sta | Dist | Az F/B | Inc F/B | L R | U D"}),(0,n.tZ)(j.Z,{value:"ToStaDisAzIncLrUd",children:"To Sta | Dist | Az F/B | Inc F/B | L R | U D"})]}),(0,n.tZ)(tn.Z,{onClick:i,children:(0,n.tZ)(th.Z,{})})]}),(0,n.tZ)(ta,{layoutVariant:f,useFieldProps:c})]}),(0,n.tZ)(tm,{bounds:s,onResize:u})]}):null}var ty=i(4933);function tw(){let{elements:t,push:e,remove:i}=F.useArrayField("pages"),o=function(){let t=l.useContext(Y);if(!t)throw Error("must be used inside an IdbProvider");return t}(),r=l.useCallback(t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"},[]),a=l.useCallback(async t=>{t.preventDefault();let{files:i}=t.dataTransfer;for(let t of i){let i=ty.Z();await o.add("pageImages",t,i),e({imageId:i,tables:[{layoutVariant:"IMO",bounds:function(t){let{top:e,left:i,width:n,height:l}=t;return{topLeft:{x:i,y:e},topRight:{x:i+n,y:e},bottomLeft:{x:i,y:e+l},bottomRight:{x:i+n,y:e+l}}}({top:113,left:15,width:520,height:632})}]})}},[e]);return(0,n.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",overflow:"scroll",flexGrow:1,flexShrink:1,alignSelf:"stretch",minHeight:0},onDragOver:r,onDrop:a,children:[t.map((t,e)=>(0,n.tZ)(tZ,{field:t,onDelete:()=>i(e)},e)),t.length?void 0:(0,n.tZ)(d.Z,{sx:{height:200,textAlign:"center",my:10,alignSelf:"stretch",color:"gray"},children:"Drop images here"})]})}let tI=new E.S,{FormProvider:tk,useInitialize:tS}=F;function tA(){let[t,e]=l.useState();return(N().then(e),t)?(0,n.tZ)(q,{idb:t,children:(0,n.tZ)(_.aH,{client:tI,children:(0,n.tZ)(tk,{children:(0,n.tZ)(tz,{})})})}):"Loading..."}function tz(){return tS({values:l.useMemo(()=>{try{return D.parse({...JSON.parse(localStorage.getItem("caveSurveyDataValues")||"")})}catch(t){return{outputFormat:"FRCS",backsightAzimuthCorrected:!0,backsightInclinationCorrected:!0,pages:[]}}},[])},[]),(0,n.BX)(n.HY,{children:[(0,n.tZ)(tF,{}),(0,n.BX)($,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0},slotProps:{right:{sx:{pt:2}}},children:[(0,n.BX)(d.Z,{sx:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-start",overflow:"hidden"},children:[(0,n.BX)(d.Z,{sx:{display:"flex",flexDirection:"row",gap:1},children:[(0,n.tZ)(tP,{}),(0,n.tZ)(tD,{})]}),(0,n.BX)(d.Z,{sx:{display:"flex",flexDirection:"row",gap:4,mb:2},children:[(0,n.tZ)(te,{field:F.get("backsightAzimuthCorrected"),label:"Corrected Backsight Azimuths"}),(0,n.tZ)(te,{field:F.get("backsightInclinationCorrected"),label:"Corrected Backsight Inclinations"})]}),(0,n.tZ)(tw,{})]}),(0,n.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,n.BX)(tx,{field:F.get("outputFormat"),type:"text",label:"Format",select:!0,fullWidth:!0,children:[(0,n.tZ)(j.Z,{value:"FRCS",children:"FRCS"}),(0,n.tZ)(j.Z,{value:"Compass",children:"Compass"}),(0,n.tZ)(j.Z,{value:"Walls",children:"Walls"})]}),(0,n.tZ)(R,{fullWidth:!0,sx:{flexGrow:1,flexShrink:1,minHeight:0,mt:2}})]})]})]})}function tP(){let{value:t,setValue:e}=F.useField("pages");return(0,n.tZ)(M.Z,{onClick:()=>{e((t||[]).map(t=>{var e;return{...t,tables:null==t||null==(e=t.tables)?void 0:e.map(t=>({...t,shots:[]}))}}))},children:"Clear Data"})}function tD(){let{setValue:t}=F.useField("pages");return(0,n.tZ)(M.Z,{onClick:()=>{t([])},children:"Clear All"})}function tF(){let{value:t}=F.useField([]),e=l.useMemo(()=>h()(t=>{localStorage.setItem("caveSurveyDataValues",JSON.stringify(t))},500),[]);return l.useEffect(()=>{t&&e(t)},[t]),null}let tL=document.getElementById("root");tL&&(0,o.createRoot)(tL).render((0,n.tZ)(function(){return(0,n.BX)(a.Z,{theme:r,children:[(0,n.tZ)(s.ZP,{}),(0,n.tZ)(u.Z,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),(0,n.tZ)(tA,{})]})},{}))}},e={};function i(n){var l=e[n];if(void 0!==l)return l.exports;var o=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;i.t=function(n,l){if(1&l&&(n=this(n)),8&l||"object"==typeof n&&n&&(4&l&&n.__esModule||16&l&&"function"==typeof n.then))return n;var o=Object.create(null);i.r(o);var r={};t=t||[null,e({}),e([]),e(e)];for(var a=2&l&&n;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach(t=>{r[t]=()=>n[t]});return r.default=()=>n,i.d(o,r),o}})(),i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}})(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t=[];i.O=(e,n,l,o)=>{if(n){o=o||0;for(var r=t.length;r>0&&t[r-1][2]>o;r--)t[r]=t[r-1];t[r]=[n,l,o];return}for(var a=1/0,r=0;r<t.length;r++){for(var[n,l,o]=t[r],s=!0,u=0;u<n.length;u++)(!1&o||a>=o)&&Object.keys(i.O).every(t=>i.O[t](n[u]))?n.splice(u--,1):(s=!1,o<a&&(a=o));if(s){t.splice(r--,1);var d=l();void 0!==d&&(e=d)}}return e}})(),i.rv=()=>"1.3.11",(()=>{var t={980:0};i.O.j=e=>0===t[e];var e=(e,n)=>{var l,o,[r,a,s]=n,u=0;if(r.some(e=>0!==t[e])){for(l in a)i.o(a,l)&&(i.m[l]=a[l]);if(s)var d=s(i)}for(e&&e(n);u<r.length;u++)o=r[u],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(d)},n=self.webpackChunk_speleotica_cave_survey_data_entry=self.webpackChunk_speleotica_cave_survey_data_entry||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),i.ruid="bundler=rspack@1.3.11";var n=i.O(void 0,["361","214"],function(){return i(420)});n=i.O(n)})();